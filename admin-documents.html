<script src="js/main.js"></script>
<script>
document.addEventListener("DOMContentLoaded", loadDocs);

async function loadDocs() {
  const res = await fetch("/api/clients");
  const clients = await res.json();

  let allDocs = [];

  for (const c of clients) {

    // 1. Normal uploaded documents
    const d = await fetch(`/api/clients/${c.id}/documents`);
    const docs = await d.json();

    docs.forEach(doc => allDocs.push({ 
      ...doc, 
      client: c,
      source: "upload"
    }));

    // 2. Intake documents (NEW)
    const intakeRes = await fetch(`/api/clients/${c.id}/intake`);
    if (intakeRes.ok) {
      const intakeDocs = await intakeRes.json();

      intakeDocs.forEach(doc => allDocs.push({
        ...doc,
        client: c,
        source: "intake"
      }));
    }
  }

  const box = document.getElementById("docsList");

  box.innerHTML = allDocs.map(d => `
    <div class="doc-item">
      <strong>${d.originalName || "Intake Form"}</strong><br>
      Client: ${d.client.name || d.client.email}<br>
      Type: ${d.source === "intake" ? "Client Intake" : "Uploaded Document"}<br>
      Uploaded: ${new Date(d.uploadedAt).toLocaleString()}<br>
      <a href="/uploads/${d.filename}" class="btn secondary" style="margin-top:8px;">Download</a>
    </div>
  `).join("");
}
</script>
