<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Client Dashboard - Solidified Tax Group</title>
  <link rel="stylesheet" href="styles/style.css" />
</head>

<body>

  <header class="topbar">
    <div class="st-logo">
      <span class="st-s">S</span>
      <span class="st-t">T</span>
      <span class="st-dot-left"></span>
      <span class="st-dot-top"></span>
    </div>

    <nav>
      <a href="index.html">Home</a>
      <a href="client.html">Client Login</a>
      <a href="client-dashboard.html">Dashboard</a>
      <a href="contact.html">Contact</a>
    </nav>

    <button class="theme-toggle" id="themeToggle">Theme</button>
  </header>

  <main class="page">

    <section class="card">
      <h2>Client Dashboard</h2>
      <p id="clientWelcome">Welcome.</p>
    </section>

    <section class="card">
      <h3>Your Documents</h3>
      <div id="clientDocsList">Loading documents...</div>
      <div style="margin-top:16px;">
        <a class="btn secondary" href="client-upload.html">Upload New Document</a>
      </div>
    </section>

    <section class="card">
      <h3>Actions</h3>
      <ul>
        <li><a href="client-upload.html">Upload documents</a></li>
        <li><a href="client-sign.html">Review & sign documents</a></li>
      </ul>
    </section>

  </main>

  <script src="js/main.js"></script>
  <script>
    const API_BASE = "/api";

    document.addEventListener("DOMContentLoaded", () => {
      setupClientDashboard();
    });

    async function setupClientDashboard() {
      const clientId = localStorage.getItem("clientId");
      const clientEmail = localStorage.getItem("clientEmail");

      if (!clientId) {
        window.location.href = "client.html";
        return;
      }

      if (clientEmail) {
        document.getElementById("clientWelcome").textContent =
          `Welcome, ${clientEmail}`;
      }

      loadClientDocuments(clientId);
    }

    async function loadClientDocuments(clientId) {
      const container = document.getElementById("clientDocsList");

      try {
        const res = await fetch(`${API_BASE}/clients/${clientId}/documents`);
        const docs = await res.json();

        if (!docs.length) {
          container.textContent = "No documents uploaded yet.";
          return;
        }

        container.innerHTML = docs.map(d => `
          <div class="doc-item">
            <strong>${d.originalName || "Document #" + d.id}</strong><br>
            Uploaded: ${new Date(d.uploadedAt).toLocaleString()}<br>
            ${d.signedAt ? `<span class="badge">Signed</span>` : ""}
          </div>
        `).join("");

      } catch {
        container.textContent = "Unable to load documents.";
      }
    }
  </script>

</body>
</html>
